<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegisMemoria</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container-fluid p-0">
    <div class="row g-0">
        
        <nav class="col-md-3 col-lg-2 bg-dark sidebar p-3 text-white d-flex flex-column">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="m-0 fw-bold text-primary">ðŸ“‚ LegisMemoria</h5>
                <button onclick="alternarTema()" id="btnTema" class="btn btn-outline-light" title="Mudar Tema">ðŸŒ™</button>
            </div>

            <div class="input-group mb-3">
                <input type="text" id="novaPastaNome" class="form-control form-control-sm" placeholder="Nova pasta...">
                <button onclick="criarPasta()" class="btn btn-primary btn-sm">+</button>
            </div>
            
            <div id="listaPastas" class="list-group list-group-flush mb-3 flex-grow-0" style="max-height: 35vh; overflow-y: auto;">
                </div>
            
            <hr class="border-secondary opacity-50">
            
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 id="tituloPastaAtiva" class="text-info small fw-bold m-0 text-truncate">Selecione uma Pasta</h6>
                <small id="contagemCards" class="text-muted" style="font-size: 0.7rem;">0 cards</small>
            </div>

            <button id="btnNovoCard" class="btn btn-primary btn-sm w-100 mb-3 d-none" onclick="mostrarSetup()">+ Novo Card</button>
            
            <div id="listaCards" class="list-group list-group-flush flex-grow-1" style="overflow-y: auto; min-height: 0;">
                </div>

            <div class="mt-3 pt-3 border-top border-secondary opacity-50">
                <h6 class="small mb-2 fw-bold text-white-50">ðŸ“¦ Dados & Backup</h6>
                <div class="d-flex gap-2">
                    <button onclick="exportarBackup()" class="btn btn-outline-light btn-sm w-50" title="Baixar dados">â¬‡ Export</button>
                    <button onclick="triggerImport()" class="btn btn-outline-warning btn-sm w-50" title="Carregar dados">â¬† Import</button>
                </div>
                <input type="file" id="fileInput" class="d-none" accept=".json" onchange="importarBackup(this)">
            </div>
        </nav>

        <main class="col-md-9 col-lg-10 main-content">
            
            <div id="dashboardArea">
                <h2 class="mb-4 fw-light title-page">Painel de Controle</h2>
                
                <div class="row g-3 mb-4">
                    <div class="col-md-3">
                        <div class="card bg-danger text-white p-3 shadow-sm h-100 border-0">
                            <h6>CrÃ­ticos (NÃ­vel < 4)</h6>
                            <div id="kpiCriticos" class="h2 mt-2 fw-bold">0</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-warning text-dark p-3 shadow-sm h-100 border-0">
                            <h6>AtenÃ§Ã£o (NÃ­vel 4-7)</h6>
                            <div id="kpiAtencao" class="h2 mt-2 fw-bold">0</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success text-white p-3 shadow-sm h-100 border-0">
                            <h6>Seguros (NÃ­vel 8-10)</h6>
                            <div id="kpiSeguros" class="h2 mt-2 fw-bold">0</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-primary text-white p-3 shadow-sm h-100 border-0">
                            <h6>Tempo Total</h6>
                            <div id="dashTempoTotal" class="h4 mt-2 fw-bold">00:00</div>
                        </div>
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card p-3 shadow-sm h-100 card-bg">
                            <h6 class="text-muted border-bottom pb-2">DistribuiÃ§Ã£o da MemÃ³ria</h6>
                            <div style="height: 250px; display: flex; justify-content: center;">
                                <canvas id="chartDistribuicao"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card p-3 shadow-sm h-100 card-bg">
                            <h6 class="text-muted border-bottom pb-2">DomÃ­nio por Pasta (MÃ©dia NÃ­vel)</h6>
                            <div style="height: 250px;">
                                <canvas id="chartBarras"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12">
                         <h6 class="text-muted border-bottom pb-2">Decaimento em Tempo Real (PrÃ³xima Queda)</h6>
                         <div id="dashDecaimento" class="decay-list-container" style="max-height: 500px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>

            <div id="setupArea" class="card shadow-sm p-4 mx-auto d-none card-bg" style="max-width: 800px;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 id="setupTitle" class="title-page">Novo Card</h4>
                    <button onclick="voltarAoDashboard()" class="btn-close btn-close-custom"></button>
                </div>
                <div class="mb-3">
                    <label class="form-label small text-muted">TÃ­tulo</label>
                    <input type="text" id="cardTitle" class="form-control" placeholder="Ex: Art. 5Âº CF - Caput">
                </div>
                <div class="mb-3">
                    <label class="form-label small text-muted">ConteÃºdo</label>
                    <textarea id="rawText" class="form-control" rows="10" placeholder="Cole o texto aqui..."></textarea>
                </div>
                <div class="d-flex gap-2 justify-content-end">
                    <button onclick="voltarAoDashboard()" class="btn btn-outline-secondary">Cancelar</button>
                    <button onclick="salvarCard()" class="btn btn-success px-4">Salvar</button>
                </div>
            </div>

            <div id="trainingArea" class="d-none" style="max-width: 900px; margin: 0 auto;">
                
                <div id="statusHeader" class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 id="tituloCardAtivo" class="h4 m-0 title-page">TÃ­tulo</h2>
                        <div>
                            <span id="faseStatus" class="badge bg-secondary me-1">Fase</span>
                            <span id="infoBadge" class="badge bg-primary">Rodada</span>
                            <button onclick="voltarAoDashboard()" class="btn btn-outline-secondary btn-sm ms-2">Sair</button>
                        </div>
                    </div>
                    
                    <div class="progress rounded-0 progress-track" style="height: 8px;">
                        <div id="progressBarEstudo" class="progress-bar bg-success" role="progressbar" style="width: 0%; transition: none;"></div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-1 text-muted" style="font-size: 0.8rem;">
                        <span>Progresso da SessÃ£o</span>
                        <span id="labelProgresso">0%</span>
                    </div>

                    <div class="d-flex gap-3 align-items-center mt-3 p-3 rounded border card-bg shadow-sm">
                        <small class="stats-label">Winrate: <strong id="winratePerc" class="text-success">100%</strong></small>
                        <small class="stats-label">Tempo: <strong id="cronometroDisplay">00:00</strong></small>
                        <small class="stats-label">NÃ­vel Atual: <strong id="nivelFixacao" class="badge bg-info text-dark">0/10</strong></small>
                    </div>
                </div>

                <div id="textDisplay" class="mb-4 shadow-sm p-4 rounded card-bg"></div>
                
                <div class="input-group mb-2">
                    <input type="text" id="userInput" class="form-control form-control-lg" placeholder="Digite a palavra oculta..." autocomplete="off">
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">EspaÃ§o ou Enter para confirmar.</small>
                    <button onclick="usarDica()" id="btnDica" class="btn btn-link btn-sm text-danger p-0 text-decoration-none fw-bold">
                        ðŸ’¡ Ver Resposta (Zera NÃ­vel)
                    </button>
                </div>

                <div id="errorArea" class="mt-4 pt-3 border-top d-none">
                    <h6 class="text-muted small fw-bold">ERROS:</h6>
                    <ul id="errorList" class="p-0 m-0 text-danger small" style="list-style: none;"></ul>
                </div>
            </div>
        </main>
    </div>
</div>

<div class="modal fade" id="hintModal" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content card-bg">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">ðŸ“– Leitura de Suporte</h5>
                <button type="button" class="btn-close btn-close-white" onclick="bootstrapModal.hide()"></button>
            </div>
            <div class="modal-body">
                <p id="fullTextHint" class="lh-lg p-3 rounded shadow-sm bg-body-tertiary text-dark" style="white-space: pre-wrap; font-size: 1.1rem;"></p>
                <div class="alert alert-warning mb-0 small border-warning text-warning-emphasis">
                    <strong>AtenÃ§Ã£o:</strong> O nÃ­vel deste card serÃ¡ resetado para 0.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger w-100 fw-bold" onclick="estouPronto()">Retomar Treino (NÃ­vel 0)</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="script.js"></script>
</body>
</html>